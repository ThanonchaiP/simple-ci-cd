version: 2.1

orbs:
  aws-ecr: orbies/aws-ecr@1.2.1

workflows:
  build_and_push_image:
    jobs:
      - aws-ecr/build-and-push-image:
          account-url: AWS_ECR_ACCOUNT_URL
          aws-access-key-id: AWS_ACCESS_KEY
          aws-secret-access-key: AWS_ACCESS_SECRET
          path: .
          region: AWS_REGION_NAME
          repo: cyber/non/test
          skip-when-tags-exist: false
          tag: '0.0.2'
# version: '2.1'
# orbs:
#   aws-cli: circleci/aws-cli@2.0
#   aws-ecr: circleci/aws-ecr@8.1.3
# jobs:
#   aws-cli-cred-setup:
#     executor: aws-cli/default
#     steps:
#       - aws-cli/setup:
#           aws-access-key-id: AWS_ACCESS_KEY
#           aws-secret-access-key: AWS_ACCESS_SECRET
#           aws-region: AWS_REGION_NAME
# workflows:
#   aws-cli:
#     jobs:
#       - aws-cli-cred-setup:
#           context: aws
#       - aws-ecr/build-and-push-image:
#           requires:
#             - aws-cli-cred-setup
#           context: aws-dev
#           create-repo: true
#           dockerfile: Dockerfile
#           path: .
#           repo: 654656542116.dkr.ecr.ap-southeast-1.amazonaws.com/cyber/non/test
#           tag: '0.0.2'
# # Use the latest 2.1 version of CircleCI pipeline process engine.
# # See: https://circleci.com/docs/configuration-reference
# version: 2.1

# orbs:
#   aws-ecr: circleci/aws-ecr@8.1.3

# # Define a job to be invoked later in a workflow.
# # See: https://circleci.com/docs/configuration-reference/#jobs
# jobs:
#   say-hello:
#     # Specify the execution environment. You can specify an image from Docker Hub or use one of our convenience images from CircleCI's Developer Hub.
#     # See: https://circleci.com/docs/configuration-reference/#executor-job
#     docker:
#       - image: cibuilds/aws:1.16.1
#     # Add steps to the job
#     # See: https://circleci.com/docs/configuration-reference/#steps
#     steps:
#       - checkout
#       - run:
#           name: 'ls'
#           command: 'ls'
#       - run:
#           name: 'cat'
#           command: 'cat README.md'
#       - run:
#           name: 'makefile'
#           command: 'make -v'

# # Orchestrate jobs using workflows
# # See: https://circleci.com/docs/configuration-reference/#workflows
# workflows:
#   say-hello-workflow:
# jobs:
#   - aws-ecr/build-and-push-image:
#       context: aws-dev
#       create-repo: true
#       dockerfile: Dockerfile
#       path: .
#       repo: 654656542116.dkr.ecr.ap-southeast-1.amazonaws.com/cyber/non/test
#       tag: '0.0.2'
# # # Use the latest 2.1 version of CircleCI pipeline process engine.
# # # See: https://circleci.com/docs/configuration-reference
# # version: 2.1

# # # orbs:
# # #   aws-ecr: circleci/aws-ecr@9.0.1

# # # Define a job to be invoked later in a workflow.
# # # See: https://circleci.com/docs/configuration-reference/#jobs
# # jobs:
# #   say-hello:
# #     # Specify the execution environment. You can specify an image from Docker Hub or use one of our convenience images from CircleCI's Developer Hub.
# #     # See: https://circleci.com/docs/configuration-reference/#executor-job
# #     docker:
# #       - image: cimg/base:stable
# #     # Add steps to the job
# #     # See: https://circleci.com/docs/configuration-reference/#steps
# #     steps:
# #       - checkout
# #       - run:
# #           name: 'Say hello'
# #           command: 'echo Hello, World!'
# #   test-build:
# #     # docker:
# #     #   - image: 654656542116.dkr.ecr.ap-southeast-1.amazonaws.com/cyber/non/test:0.0.1
# #     #     aws_auth:
# #     #       aws_access_key_id: AKIAZQ3ESCWSEGIAL62Z
# #     #       aws_secret_access_key: 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
# #     steps:
# #       - checkout
# #         # Install via apk on alpine based images
# #       - run:
# #           name: Run makefile
# #           command: make build-image VERSION=0.0.2
# #       # - run:
# #       #     name: 'run container'
# #       #     command: 'docker run -d -p 3000:3000/tcp 654656542116.dkr.ecr.ap-southeast-1.amazonaws.com/cyber/non/test'

# # # Orchestrate jobs using workflows
# # # See: https://circleci.com/docs/configuration-reference/#workflows
# # workflows:
# #   say-hello-workflow:
# #     jobs:
# #       - test-build
# #       # - say-hello
